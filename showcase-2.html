<html>
  <head>
    <meta charset="utf-8" />
    <title>Jasmine Spec Runner v5.5.0</title>

    <link rel="shortcut icon" type="image/png" href="lib/jasmine-5.0.0/jasmine_favicon.png" />
    <link rel="stylesheet" href="lib/jasmine-5.0.0/jasmine.css" />

    <script src="lib/jasmine-5.0.0/jasmine.js"></script>
    <script src="lib/jasmine-5.0.0/jasmine-html.js"></script>
    <script src="lib/jasmine-5.0.0/boot0.js"></script>
    <script src="lib/jasmine-5.0.0/boot1.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              clifford: '#da373d',
            },
          },
        },
      };
    </script>
  </head>
  <body>
    <form id="add-product-form">
      <div class="max-w-xl mx-auto my-16 flex flex-col w-full gap-4">
        <div class="form-group">
          <input class="border p-3 w-full rounded-md" id="name" type="text" placeholder="Name" />
          <div class="name-error text-red-500 text-sm"></div>
        </div>
        <div class="form-control">
          <textarea
            class="border p-3 w-full rounded-md"
            id="description"
            placeholder="Description..."
          ></textarea>
          <div class="description-error text-red-500 text-sm"></div>
        </div>
        <div class="flex w-full gap-3">
          <div class="form-group flex-1">
            <input
              class="border p-3 w-full rounded-md"
              type="text"
              placeholder="Category"
              id="category"
            />
            <div class="category-error text-red-500 text-sm"></div>
          </div>
          <div class="form-group flex-1">
            <input
              class="border p-3 w-full rounded-md"
              type="number"
              placeholder="Price"
              id="price"
            />
            <div class="price-error text-red-500 text-sm"></div>
          </div>
        </div>
        <div class="form-group">
          <input
            class="border p-3 w-full rounded-md"
            type="text"
            placeholder="Photo url"
            id="photo"
          />
          <div class="photo-error text-red-500 text-sm"></div>
        </div>
        <button
          class="py-3 overflow-hidden text-white bg-yellow-600 border rounded-lg hover:bg-yellow-500"
        >
          Create product
        </button>
      </div>
    </form>

    <script>
      const nameInput = document.getElementById('name');
      const includes = ['name', 'category', 'price', 'photo'];

      function validator(fieldName, element, condition) {
        const errorMessageElement = document.querySelector(`.${fieldName}-error`);

        if (!condition) {
          const errorMessage = `${fieldName} is required.`;
          errorMessageElement.innerHTML = errorMessage;
          element.classList.add('border-red-500');
        } else {
          element.classList.remove('border-red-500');
          errorMessageElement.innerHTML = '';
        }
      }

      document.addEventListener('load', () => {
        includes.forEach((fieldName) => {
          const element = document.getElementById(fieldName);
          element.addEventListener('change', (e) => {
            if (e.target?.localName === 'textarea') {
              validator(fieldName, e.target, e.target.innerText.trim() != '');
            } else {
              validator(fieldName, e.target, e.target.value.trim() != '');
            }
          });
        });
      });

      document.getElementById('add-product-form')?.addEventListener('submit', (e) => {
        includes.forEach((fieldName) => {
          const element = document.getElementById(fieldName);
          if (element?.localName === 'textarea') {
            validator(fieldName, element, element.innerText.trim() != '');
          } else {
            validator(fieldName, element, element.value.trim() != '');
          }
        });
      });
    </script>

    <script>
      describe('Form validation', () => {
        let form;

        beforeEach(function () {
          form = document.getElementById('add-product-form');
          if (!form) throw new Error('Form is still not initialized');
        });

        it('Test Case 1: Missing Field values', function () {
          // Simulate form submission without entering a name
          form.dispatchEvent(new Event('submit'));

          // Expect an error message to be displayed for the name field
          const nameErrorMessage = form.querySelector('.name-error');
          const categoryErrorMessage = form.querySelector('.category-error');
          const priceErrorMessage = form.querySelector('.price-error');
          const photoErrorMessage = form.querySelector('.photo-error');
          expect(nameErrorMessage.innerText != '').toBeTruthy(
            'name are empty, but not found any error message'
          );
          expect(categoryErrorMessage.innerText != '').toBeTruthy(
            'category are empty, but not found any error message'
          );
          expect(priceErrorMessage.innerText != '').toBeTruthy(
            'price are empty, but not found any error message'
          );
          expect(photoErrorMessage.innerText != '').toBeTruthy(
            'photo url are empty, but not found any error message'
          );
        });

        describe('Test Case 2: Invalid category', function () {
          const categoryList = ['Food', 'Beverage', 'Fruit'];

          beforeEach(function () {
            const name = form.querySelector('input#name');
            const description = form.querySelector('textarea#description');
            const category = form.querySelector('input#category');

            name.value = 'Mango';
            description.value = 'A tropical fruit, located in Vietnam, Thailand, Philippines,...';
            category.value = 'Smartphone';
          });

          it(
            'Should display an error message when category is not included in: ' +
              categoryList.join(','),
            function () {
              // Simulate form submission without entering a name
              form.dispatchEvent(new Event('submit'));
              const category = form.querySelector('input#category');
              expect(categoryList.includes(category.value)).toBe(true, 'Invalid category');
            }
          );
        });
      });
    </script>
  </body>
</html>
